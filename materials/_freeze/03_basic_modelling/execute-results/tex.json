{
  "hash": "5ce4c085c78d5544344b7925fd45c140",
  "result": {
    "markdown": "---\ntitle: \"Africast-Time Series Analysis & Forecasting Using R\"\nsubtitle: \"5. Basic modeling and forecasting\"\n---\n\n\n## Outline\n\n\\vspace*{0.7cm}\\tableofcontents\n\n\n\n\n\n\n# Statistical forecasting\n\n## Forecasting workflow\n\n\n::: {.cell layout-align=\"center\" hash='03_basic_modelling_cache/beamer/forecasting_process_aea1e77ee6653e6fcf920f4836a57879'}\n::: {.cell-output-display}\n![](figs/forecasting_workflow.png){fig-align='center' width=2.37in}\n:::\n:::\n\n\n## Statistical forecasting steps\n\n* Prepare data.\n* Visualise data.\n* Choosing and fitting models (specify and train models).\n* Produce forecast.\n* Evaluate quality.\n\n## What is a forecast?\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa_e7894b476c53efbba0ab402bd4861ba2'}\n\n:::\n\n\n\\forecast\\pause\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa1_e3148c217ea1a32a142335c89dc8a145'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa1-1.pdf)\n:::\n:::\n\n\n## What is a forecast?\n\n\\forecast\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa2_7d04c60aeb5ab1b90a11d66bcd78a3c4'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa2-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## What is a forecast?\n\n\\forecast\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa3_67f3a955e51d352141faabc662d4df30'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa3-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## What is a forecast?\n\n\\forecast\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa4_4e4fc664461ccae2031146b6dc1246bd'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa4-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## What is a forecast?\n\n\\forecast\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa5_2dbbbe5dac730b50cd0c270aba133ff4'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa5-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## What is a forecast?\n\n\\forecast\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa6_ed164f20b2d6b85e844f6e47252b1cd6'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa6-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## What is a forecast?\n\n\\forecast\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa7_63a688699d039f09f2fc0225f0c7e9f3'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa7-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## What is a forecast?\n\n\\forecast\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa8_dde25eb33c7c4610749fa4daf77f7070'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa8-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Prediction interval\n\n\\forecast\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa9_61ddf87db9be57a3e4812c1f5a5e3980'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa9-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## Visualising forecast distributions\n\n\n::: {.cell layout-align=\"center\" hash='03_basic_modelling_cache/beamer/viz-prob-forecast_dafeb72d6f19909df3100374c44d6051'}\n::: {.cell-output-display}\n![](figs/daily_probabilistic_forecast.png){fig-align='center' width=70%}\n:::\n:::\n\n\n## Forecast distribution\n\n\n::: {.cell layout-align=\"center\" hash='03_basic_modelling_cache/beamer/fcst-viz-dist_a542dd0775b04311a78df9ac73c90b72'}\n::: {.cell-output-display}\n![](figs/forecasts_probabilistic_perspective.png){fig-align='center' width=70%}\n:::\n:::\n\n\n## Statistical forecasting\n\n- Thing to be forecast: $y_{T+h}$.\n- What we know: $y_1,\\dots,y_T$.\n- Forecast distribution: ${y}_{T+h|t} = y_{T+h} \\mid \\{y_1,y_2,\\dots,y_{T}\\}$.\n- Point forecast: $\\hat{y}_{T+h|T} =\\text{E}[y_{T+h} \\mid y_1,\\dots,y_T]$.\n- Forecast variance: $\\text{Var}[y_{t}  \\mid y_1,\\dots,y_T]$\n- Prediction interval is a range of values of $y_{T+h}$ with high probability.\n\n\n# What can we forecast?\n\n## What can we forecast?\n\n\\forecast\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/austa9b_4d3ea78de829db94598e4b0f744b4af1'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/austa9b-1.pdf)\n:::\n:::\n\n\n\\simfutures\n\n## What can we forecast?\n\n\\full{nasdaq-stock-market}\n\n## What can we forecast?\n\n\\full{Forex2}\n\n## What can we forecast?\n\n\\full{pills}\n\n## What can we forecast?\n\n\\full{elecwires2}\n\n## What can we forecast?\n\n\\full{AusBOM}\n\n## What can we forecast?\n\n\\full{ts22015}\n\n## What can we forecast?\n\n\\full{comet}\n\n## Which is easiest to forecast?\n\n 1. daily electricity demand in 3 days time\n 2. timing of next Halley's comet appearance\n 3. time of sunrise this day next year\n 4. Google stock price tomorrow\n 5. Google stock price in 6 months time\n 6. maximum temperature tomorrow\n 7. exchange rate of \\$US/AUS next week\n 8. total sales of drugs in Australian pharmacies next month\n\n\\pause\n\n - how do we measure \"easiest\"?\n - what makes something easy/difficult to forecast?\n\n## Factors affecting forecastability\n\nSomething is easier to forecast if:\n\n - we have a good understanding of the factors that contribute to it\n - there is lots of data available;\n - the forecasts cannot affect the thing we are trying to forecast.\n - there is relatively low natural/unexplainable random variation.\n - the future is somewhat similar to the past\n\n\n# Benchmark methods\n\n## Some simple forecasting methods\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/ausbeer_33e3a38c2f7eb19d77698095f3a21f50'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/ausbeer-1.pdf){width=90%}\n:::\n:::\n\n\n\\begin{textblock}{7}(0.4,6.9)\n\\begin{alertblock}{}\n\\small{How would you forecast these series?}\n\\end{alertblock}\n\\end{textblock}\n\n## Some simple forecasting methods\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/pigs_798a7f0814b48c925579c607d901afe6'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/pigs-1.pdf){width=90%}\n:::\n:::\n\n\n\\begin{textblock}{7}(0.4,6.9)\n\\begin{alertblock}{}\n\\small{How would you forecast these series?}\n\\end{alertblock}\n\\end{textblock}\n\n## Some simple forecasting methods\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/dj_0ac0f27dc684b735bbad03d677b5ba59'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/dj-1.pdf){width=90%}\n:::\n:::\n\n\n\\begin{textblock}{7}(0.4,6.9)\n\\begin{alertblock}{}\n\\small{How would you forecast these series?}\n\\end{alertblock}\n\\end{textblock}\n\n## Some simple forecasting methods\n\\fontsize{13}{14}\\sf\n\n### `MEAN(y)`: Average method\n\n  * Forecast of all future values is equal to mean of historical data $\\{y_1,\\dots,y_T\\}$.\n  * Forecasts: $\\hat{y}_{T+h|T} = \\bar{y} = (y_1+\\dots+y_T)/T$\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/mean-method-explained_e956a31af2a157d30e6961fd13200244'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/mean-method-explained-1.pdf)\n:::\n:::\n\n\n## Some simple forecasting methods\n\\fontsize{13}{14}\\sf\n\n### `NAIVE(y)`: Naïve method\n\n  * Forecasts equal to last observed value.\n  * Forecasts: $\\hat{y}_{T+h|T} =y_T$.\n  * Consequence of efficient market hypothesis.\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/naive-method-explained_59ff7b529af955064c64f1a58ea30821'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/naive-method-explained-1.pdf)\n:::\n:::\n\n\n## Some simple forecasting methods\n\\fontsize{13}{14}\\sf\n\n### `SNAIVE(y ~ lag(m))`: Seasonal naïve method\n\n  * Forecasts equal to last value from same season.\n  * Forecasts: $\\hat{y}_{T+h|T} =y_{T+h-m(k+1)}$, where $m=$ seasonal period and $k$ is the integer part of $(h-1)/m$.\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/snaive-method-explained_934e03cc12b0b6ffe519d45202e8a79f'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/snaive-method-explained-1.pdf)\n:::\n:::\n\n\n## Some simple forecasting methods\n\\fontsize{13}{14}\\sf\n\n### `RW(y ~ drift())`: Drift method\n\n * Forecasts equal to last value plus average change.\n * Forecasts:\\vspace*{-.7cm}\n\n \\begin{align*}\n \\hat{y}_{T+h|T} & =  y_{T} + \\frac{h}{T-1}\\sum_{t=2}^T (y_t-y_{t-1})\\\\\n                 & = y_T + \\frac{h}{T-1}(y_T -y_1).\n \\end{align*}\\vspace*{-0.2cm}\n\n   * Equivalent to extrapolating a line drawn between first and last observations.\n\n## Some simple forecasting methods\n\n### Drift method\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/drift-method-explained_7b30f184d28fc346e321ebf02a21446c'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/drift-method-explained-1.pdf)\n:::\n:::\n\n\n# Specify and estimate\n\n## Model specification\n\n- Model specification in fable supports a formula based interface \n- A model formula in R is expressed using `response ~ terms`\n    - the formula’s left side describes the response \n    - the right describes terms used to model the response.\n- `Attention`: MODEL name is in capital letters, e.g. `SNAIVE`\n\n## Model estimation\n\nThe `model()` function trains models on data.\n- It returns a `mable` object.\n\n\\fontsize{10}{13}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/model_template_bb108d1e4fd1cc4ea732bd4182e98883'}\n\n```{.r .cell-code}\n# Fit the models\nmy_mable <- my_data %>%\n  model(\n    choose_name1 = MODEL1(response ~ term1+...),\n    choose_name2 = MODEL2(response ~ term1+...),\n    choose_name3 = MODEL3(response ~ term1+...),\n    choose_name4 = MODEL4(response ~ term1+...)\n  )\n```\n:::\n\n\n\n## Model fitting- example\n\nThe `model()` function trains models on data.\n\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/beer-model_052f513599b5be480f35cf80eeb2a21f'}\n\n```{.r .cell-code}\nbeer_fit <- aus_production |>\n  model(\n    `Seasonal_naïve` = SNAIVE(Beer),\n    `Naïve` = NAIVE(Beer),\n    Drift = RW(Beer ~ drift()),\n    Mean = MEAN(Beer)\n  )\n```\n:::\n\n::: {.cell hash='03_basic_modelling_cache/beamer/beer-model2_ba2db20b77815804009fec52a1be868b'}\n::: {.cell-output .cell-output-stdout}\n```\n# A mable: 1 x 4\n  Seasonal_naïve   Naïve         Drift    Mean\n         <model> <model>       <model> <model>\n1       <SNAIVE> <NAIVE> <RW w/ drift>  <MEAN>\n```\n:::\n:::\n\n\n\\vspace*{0.2cm}\\begin{alertblock}{}\nA \\texttt{mable} is a model table, each cell corresponds to a fitted model.\n\\end{alertblock}\n\n## Extract information from `mable`\n\n\\fontsize{10}{12}\\sf\n\n::: {.cell hash='03_basic_modelling_cache/beamer/beer-mablea_64b9a9021a3ceaef4da37e378ff031bf'}\n\n```{.r .cell-code}\nbeer_fit %>% select(snaive) %>% report()\nbeer_fit %>% tidy()\nbeer_fit %>% glance()\n```\n:::\n\n\n- The `report()` function gives a formatted model-specific display.\n- The `tidy()` function is used to extract the coefficients from the models.\n- We can extract information about some specific model using the `filter()` and `select()`functions.\n\n## Check model performance\n\nOnce a model has been fitted, it is important to check  how well it has performed on the data. I come back to this latter.\n\n# Produce forecasts\n\n## Producing forecasts\n\n- The `forecast()` function is used to produce forecasts from estimated models.\n- **h** can be specified with:\n    * a number (the number of future observations)\n    * natural language (the length of time to predict)\n    * provide a dataset of future time periods\n    \n## Producing forecasts\n\n\\fontsize{10}{13}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/beer-fc_74dc78695b6312e7f54dff1c9f7249e3'}\n\n```{.r .cell-code}\nbeer_fc <- beer_fit |>\n  forecast(h = \"5 years\")\n```\n:::\n\n::: {.cell hash='03_basic_modelling_cache/beamer/beer-fbl_f166d95cced4ee898f70f3ecb5f37060'}\n::: {.cell-output .cell-output-stdout}\n```\n# A fable: 80 x 4 [1Q]\n# Key:     .model [4]\n  .model         Quarter        Beer .mean\n  <chr>            <qtr>      <dist> <dbl>\n1 Seasonal_naïve 2010 Q3 N(419, 373)   419\n2 Seasonal_naïve 2010 Q4 N(488, 373)   488\n3 Seasonal_naïve 2011 Q1 N(414, 373)   414\n4 Seasonal_naïve 2011 Q2 N(374, 373)   374\n# i 76 more rows\n```\n:::\n:::\n\n\n\\vspace*{0.2cm}\\begin{alertblock}{}\nA \\texttt{fable} is a forecast table with point forecasts and distributions.\n\\end{alertblock}\n\n## Visualising forecasts\n\n\\footnotesize\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/beer-fc-plot_09bcd14bfb6b19e30d58d76f010320b0'}\n\n```{.r .cell-code}\nbeer_fc |>\n  autoplot(aus_production, level = NULL) +\n  labs(title = \"Forecasts for quarterly beer production\",\n       x = \"Quarter\", y = \"Megalitres\") +\n  guides(colour = guide_legend(title = \"Forecast\"))\n```\n\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/beer-fc-plot-1.pdf)\n:::\n:::\n\n\n\n## Forecast distributions\n\n * A forecast $\\hat{y}_{T+h|T}$ is (usually) the mean of the conditional distribution $y_{T+h} \\mid y_1, \\dots, y_{T}$.\n * Most time series models produce normally distributed forecasts.\n * The forecast distribution describes the probability of observing any future value.\n\n## Forecast distributions - normal distribution\n\n\\fontsize{14}{18}\\sf\n\nAssuming residuals are normal, uncorrelated, sd = $\\hat\\sigma$:\n\n\\begin{block}{}\n\\begin{tabular}{ll}\n\\bf Mean: & $\\hat{y}_{T+h|T} \\sim N(\\bar{y}, (1 + 1/T)\\hat{\\sigma}^2)$\\\\[0.2cm]\n\\bf Naïve: & $\\hat{y}_{T+h|T} \\sim N(y_T, h\\hat{\\sigma}^2)$\\\\[0.2cm]\n\\bf Seasonal naïve: & $\\hat{y}_{T+h|T} \\sim N(y_{T+h-m(k+1)}, (k+1)\\hat{\\sigma}^2)$\\\\[0.2cm]\n\\bf Drift: & $\\hat{y}_{T+h|T} \\sim N(y_T + \\frac{h}{T-1}(y_T - y_1),h\\frac{T+h}{T}\\hat{\\sigma}^2)$\n\\end{tabular}\n\\end{block}\n\nwhere $k$ is the integer part of $(h-1)/m$.\n\nNote that when $h=1$ and $T$ is large, these all give the same approximate forecast variance: $\\hat{\\sigma}^2$.\n \n## Forecast distributions from bootstrapping\n\nWhen a normal distribution for the residuals is an unreasonable assumption, one alternative is to use bootstrapping, which only assumes that the residuals are uncorrelated with constant variance.\n\n- A one-step forecast error is defined as $e_t = y_t - \\hat{y}_{t|t-1}$, $y_t = \\hat{y}_{t|t-1} + e_t.$\n\n- So we can simulate the next observation of a time series using $y_{T+1} = \\hat{y}_{T+1|T} + e_{T+1}$\n\n- Adding the new simulated observation to our data set, we can repeat the process to obtain $y_{T+2} = \\hat{y}_{T+2|T+1} + e_{T+2}$\n\n## Generate many possible future using `generate()`\n\\fontsize{10}{13}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/generate_3e9ad14b629071e33b0ead99086dfa9e'}\n\n```{.r .cell-code}\nbeer_2000 <- aus_production |> filter(year(Quarter) == 2000) |> select(Beer)\nfit <- beer_2000 |>\n  model(NAIVE(Beer))\nsim <- fit |> generate(h = 12, times = 5, bootstrap = TRUE)\nsim\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 60 x 5 [1Q]\n# Key:       .model, .rep [5]\n   .model      .rep  Quarter .innov  .sim\n   <chr>       <chr>   <qtr>  <dbl> <dbl>\n 1 NAIVE(Beer) 1     2001 Q1  -45.3  455.\n 2 NAIVE(Beer) 1     2001 Q2  -45.3  409.\n 3 NAIVE(Beer) 1     2001 Q3  -14.3  395 \n 4 NAIVE(Beer) 1     2001 Q4  -14.3  381.\n 5 NAIVE(Beer) 1     2002 Q1  -45.3  335.\n 6 NAIVE(Beer) 1     2002 Q2  -14.3  321 \n 7 NAIVE(Beer) 1     2002 Q3   59.7  381.\n 8 NAIVE(Beer) 1     2002 Q4   59.7  440.\n 9 NAIVE(Beer) 1     2003 Q1  -14.3  426 \n10 NAIVE(Beer) 1     2003 Q2  -45.3  381.\n# i 50 more rows\n```\n:::\n:::\n\n\n## Generate 5 different futures\n\\fontsize{10}{13}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/visualise-future_f88c04c4dbcf8761c7810cad9414e2f7'}\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/visualise-future-1.pdf)\n:::\n:::\n\n\n## Use `forecast()` function to generate probabilistic forecasts\n\\fontsize{10}{13}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/probabilistic-forecast_5547dfd43706c33c5c195652fb0c4499'}\n\n```{.r .cell-code}\nfc <- fit |> forecast(h = 12, bootstrap = TRUE)\nfc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A fable: 12 x 4 [1Q]\n# Key:     .model [1]\n   .model      Quarter         Beer .mean\n   <chr>         <qtr>       <dist> <dbl>\n 1 NAIVE(Beer) 2001 Q1 sample[5000]  500.\n 2 NAIVE(Beer) 2001 Q2 sample[5000]  500.\n 3 NAIVE(Beer) 2001 Q3 sample[5000]  500.\n 4 NAIVE(Beer) 2001 Q4 sample[5000]  499.\n 5 NAIVE(Beer) 2002 Q1 sample[5000]  500.\n 6 NAIVE(Beer) 2002 Q2 sample[5000]  500.\n 7 NAIVE(Beer) 2002 Q3 sample[5000]  500.\n 8 NAIVE(Beer) 2002 Q4 sample[5000]  500.\n 9 NAIVE(Beer) 2003 Q1 sample[5000]  499.\n10 NAIVE(Beer) 2003 Q2 sample[5000]  500.\n11 NAIVE(Beer) 2003 Q3 sample[5000]  500.\n12 NAIVE(Beer) 2003 Q4 sample[5000]  499.\n```\n:::\n:::\n\n\n\n## Prediction intervals\n\n- Forecast intervals can be extracted using the `hilo()` function.\n\n\\fontsize{10}{13}\\sf\n\n::: {.cell hash='03_basic_modelling_cache/beamer/fb-fc_6e28c77b1935bfbdf91f9c7ab29aad66'}\n\n```{.r .cell-code}\nfit <- aus_production |> select(Beer) %>% model(NAIVE(Beer))\nforecast(fit) %>% hilo(level = 95) %>% unpack_hilo(\"95%\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 8 x 6 [1Q]\n# Key:       .model [1]\n  .model      Quarter          Beer .mean `95%_lower` `95%_upper`\n  <chr>         <qtr>        <dist> <dbl>       <dbl>       <dbl>\n1 NAIVE(Beer) 2010 Q3  N(374, 4580)   374      241.          507.\n2 NAIVE(Beer) 2010 Q4  N(374, 9159)   374      186.          562.\n3 NAIVE(Beer) 2011 Q1 N(374, 13739)   374      144.          604.\n4 NAIVE(Beer) 2011 Q2 N(374, 18319)   374      109.          639.\n5 NAIVE(Beer) 2011 Q3 N(374, 22898)   374       77.4         671.\n6 NAIVE(Beer) 2011 Q4 N(374, 27478)   374       49.1         699.\n7 NAIVE(Beer) 2012 Q1 N(374, 32057)   374       23.1         725.\n8 NAIVE(Beer) 2012 Q2 N(374, 36637)   374       -1.15        749.\n```\n:::\n:::\n\n\n## Prediction intervals\n\\fontsize{10}{12}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/beer-fc-interval_3cbf577444d16fedf88de1622d522022'}\n\n```{.r .cell-code}\nbeer_fc |>\n  hilo(level = c(50, 75))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 80 x 6 [1Q]\n# Key:       .model [4]\n   .model         Quarter         Beer .mean        `50%`        `75%`\n   <chr>            <qtr>       <dist> <dbl>       <hilo>       <hilo>\n 1 Seasonal_naïve 2010 Q3  N(419, 373)   419 [406, 432]50 [397, 441]75\n 2 Seasonal_naïve 2010 Q4  N(488, 373)   488 [475, 501]50 [466, 510]75\n 3 Seasonal_naïve 2011 Q1  N(414, 373)   414 [401, 427]50 [392, 436]75\n 4 Seasonal_naïve 2011 Q2  N(374, 373)   374 [361, 387]50 [352, 396]75\n 5 Seasonal_naïve 2011 Q3  N(419, 747)   419 [401, 437]50 [388, 450]75\n 6 Seasonal_naïve 2011 Q4  N(488, 747)   488 [470, 506]50 [457, 519]75\n 7 Seasonal_naïve 2012 Q1  N(414, 747)   414 [396, 432]50 [383, 445]75\n 8 Seasonal_naïve 2012 Q2  N(374, 747)   374 [356, 392]50 [343, 405]75\n 9 Seasonal_naïve 2012 Q3 N(419, 1120)   419 [396, 442]50 [380, 458]75\n10 Seasonal_naïve 2012 Q4 N(488, 1120)   488 [465, 511]50 [449, 527]75\n# i 70 more rows\n```\n:::\n:::\n\n\n## Prediction intervals\n\\fontsize{10}{12}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/beer-fc-interval2_b983d29ab5c671c5e3626036a35ba1c8'}\n\n```{.r .cell-code}\nbeer_fc |>\n  hilo(level = c(50, 75)) |>\n  mutate(lower = `50%`$lower, upper = `50%`$upper)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 80 x 8 [1Q]\n# Key:       .model [4]\n   .model         Quarter         Beer .mean        `50%`        `75%` lower upper\n   <chr>            <qtr>       <dist> <dbl>       <hilo>       <hilo> <dbl> <dbl>\n 1 Seasonal_naïve 2010 Q3  N(419, 373)   419 [406, 432]50 [397, 441]75  406.  432.\n 2 Seasonal_naïve 2010 Q4  N(488, 373)   488 [475, 501]50 [466, 510]75  475.  501.\n 3 Seasonal_naïve 2011 Q1  N(414, 373)   414 [401, 427]50 [392, 436]75  401.  427.\n 4 Seasonal_naïve 2011 Q2  N(374, 373)   374 [361, 387]50 [352, 396]75  361.  387.\n 5 Seasonal_naïve 2011 Q3  N(419, 747)   419 [401, 437]50 [388, 450]75  401.  437.\n 6 Seasonal_naïve 2011 Q4  N(488, 747)   488 [470, 506]50 [457, 519]75  470.  506.\n 7 Seasonal_naïve 2012 Q1  N(414, 747)   414 [396, 432]50 [383, 445]75  396.  432.\n 8 Seasonal_naïve 2012 Q2  N(374, 747)   374 [356, 392]50 [343, 405]75  356.  392.\n 9 Seasonal_naïve 2012 Q3 N(419, 1120)   419 [396, 442]50 [380, 458]75  396.  442.\n10 Seasonal_naïve 2012 Q4 N(488, 1120)   488 [465, 511]50 [449, 527]75  465.  511.\n# i 70 more rows\n```\n:::\n:::\n\n\n# Fitted values and residuals\n\n## Fitted values\n\n - $\\hat{y}_{t|t-1}$ is the forecast of $y_t$ based on observations $y_1,\\dots,y_t$.\n - We call these \"fitted values\".\n - Sometimes drop the subscript: $\\hat{y}_t \\equiv \\hat{y}_{t|t-1}$.\n - Often not true forecasts since parameters are estimated on all data.\n\n### For example:\n\n - $\\hat{y}_{t} = \\bar{y}$ for average method.\n - $\\hat{y}_{t} = y_{t-1} + (y_{T}-y_1)/(T-1)$ for drift method.\n\n## Forecasting residuals\n\n\\begin{block}{}\n\\textbf{Residuals in forecasting:} difference between observed value and its fitted value: $e_t = y_t-\\hat{y}_{t|t-1}$.\n\\end{block}\n\n\n\n## Beer production - augment\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/augment_69668e48f8c37077f4c49389a107d535'}\n\n```{.r .cell-code}\nfit <- aus_production |> select(Beer) %>% model(SNAIVE(Beer))\naugment(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 218 x 6 [1Q]\n# Key:       .model [1]\n   .model       Quarter  Beer .fitted .resid .innov\n   <chr>          <qtr> <dbl>   <dbl>  <dbl>  <dbl>\n 1 SNAIVE(Beer) 1956 Q1   284      NA     NA     NA\n 2 SNAIVE(Beer) 1956 Q2   213      NA     NA     NA\n 3 SNAIVE(Beer) 1956 Q3   227      NA     NA     NA\n 4 SNAIVE(Beer) 1956 Q4   308      NA     NA     NA\n 5 SNAIVE(Beer) 1957 Q1   262     284    -22    -22\n 6 SNAIVE(Beer) 1957 Q2   228     213     15     15\n 7 SNAIVE(Beer) 1957 Q3   236     227      9      9\n 8 SNAIVE(Beer) 1957 Q4   320     308     12     12\n 9 SNAIVE(Beer) 1958 Q1   272     262     10     10\n10 SNAIVE(Beer) 1958 Q2   233     228      5      5\n# i 208 more rows\n```\n:::\n:::\n\n\n## Beer production - fitted values\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/dj4_9283a7cc352c8a3089201fbd2e16ab4c'}\n\n```{.r .cell-code}\naugment(fit) |>\n  ggplot(aes(x = Quarter)) +\n  geom_line(aes(y = Beer, colour = \"Data\")) +\n  geom_line(aes(y = .fitted, colour = \"Fitted\"))\n```\n\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/dj4-1.pdf)\n:::\n:::\n\n\n## Beer production - residuals\n\\fontsize{10}{10}\\sf\n\n\n::: {.cell hash='03_basic_modelling_cache/beamer/dj5_8924c94b8498096f0d2a4f19bdf9a4cb'}\n\n```{.r .cell-code}\naugment(fit) |>\n  autoplot(.resid) +\n  labs(x = \"Quarter\", y = \"\", title = \"Residuals from snaïve method\")\n```\n\n::: {.cell-output-display}\n![](03_basic_modelling_files/figure-beamer/dj5-1.pdf)\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}